<!DOCTYPE html>
<html lang="zh"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoopAgent循环优化代码</title>
    <meta charset="utf-8">
    <meta name="description" content="Ladder@这里演示LoopAgent的使用方法，使用一个代码优化作为例子">
    <meta name="author" content="印象简单/EasyImpr">
    <link rel="canonical" href="https://yinxiangpingfan.github.io/agent/loopagent%E5%BE%AA%E7%8E%AF%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/">

    <link rel="alternate" type="application/rss+xml" href="https://yinxiangpingfan.github.io//index.xml" title="印象简单的博客">

    


    <meta property="og:url" content="https://yinxiangpingfan.github.io/agent/loopagent%E5%BE%AA%E7%8E%AF%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/">
  <meta property="og:site_name" content="印象简单的博客">
  <meta property="og:title" content="LoopAgent循环优化代码">
  <meta property="og:description" content="这里演示LoopAgent的使用方法，使用一个代码优化作为例子">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="agent">
    <meta property="article:published_time" content="2026-01-13T21:14:37+08:00">
    <meta property="article:modified_time" content="2026-01-13T21:14:37+08:00">
    <meta property="article:tag" content="Agent">
    <meta property="article:tag" content="Golang">
      <meta property="og:see_also" content="https://yinxiangpingfan.github.io/code/kitex/">
      <meta property="og:see_also" content="https://yinxiangpingfan.github.io/code/grpc/">
      <meta property="og:see_also" content="https://yinxiangpingfan.github.io/code/mongo/">
      <meta property="og:see_also" content="https://yinxiangpingfan.github.io/agent/%E6%B5%81%E7%A8%8B%E7%9A%84%E4%B8%AD%E6%96%AD%E4%B8%8E%E5%9B%9E%E5%A4%8D/">
      <meta property="og:see_also" content="https://yinxiangpingfan.github.io/agent/%E9%80%9A%E8%BF%87adk%E8%B0%83%E7%94%A8ai_agent%E4%BB%A5%E5%8F%8A%E5%8E%86%E5%8F%B2%E6%B6%88%E6%81%AF%E7%9A%84%E4%BF%9D%E5%AD%98/">
      <meta property="og:see_also" content="https://yinxiangpingfan.github.io/agent/%E5%9C%A8eino%E9%87%8C%E8%B0%83%E7%94%A8mcp%E5%B7%A5%E5%85%B7/">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="LoopAgent循环优化代码">
  <meta name="twitter:description" content="这里演示LoopAgent的使用方法，使用一个代码优化作为例子">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Agents",
      "item": "https://yinxiangpingfan.github.io/agent/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "LoopAgent循环优化代码",
      "item": "https://yinxiangpingfan.github.io/agent/loopagent%E5%BE%AA%E7%8E%AF%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LoopAgent循环优化代码",
  "name": "LoopAgent循环优化代码",
  "description": "这里演示LoopAgent的使用方法，使用一个代码优化作为例子\n",
  "keywords": [
    "agent", "golang"
  ],
  "articleBody": "这里演示LoopAgent的使用方法，使用一个代码优化作为例子\nLoopAgent循环优化代码 LoopAgent 的执行遵循以下设定：\n循环执行：重复执行 SubAgents 序列（序列是“有序的”）\nHistory 累积：每次迭代的结果都会累积到 History 中，后续迭代可以访问所有历史信息\n条件退出：达到最大迭代次数来终止循环，配置 MaxIterations=0 时表示无限循环\n这里演示代码优化的LoopAgent，分为两个Agent，最大进行3轮循环\n代码分析agent // 代码分析 Agent func NewCodeAnalyzerAgent() adk.Agent { a, err := adk.NewChatModelAgent(context.Background(), \u0026adk.ChatModelAgentConfig{ Name: \"CodeAnalyzer\", Description: \"分析代码质量和性能问题\", // 描述Agent功能 Instruction: `你是一个代码分析专家。你的职责是分析代码问题，不是优化代码。 请分析当前代码是否存在以下5种问题： 1. 性能瓶颈 2. 代码重复 3. 可读性问题 4. 潜在的 bug 5. 不符合最佳实践的地方 重要规则： - 如果发现任何问题，只需列出问题，然后结束回答，不要调用 exit tool - 只分析和指出问题，绝对不要给出优化建议或给出优化后的代码 - 不要自己尝试优化代码，优化工作由 CodeOptimizer 负责 - 只有在代码完全没有任何问题时，才调用 exit tool`, // Instruction是SystemMessage Model: llm.CreateDeepseekModel(), ToolsConfig: adk.ToolsConfig{ ToolsNodeConfig: compose.ToolsNodeConfig{ Tools: []tool.BaseTool{adk.ExitTool{}}, // ExitTool内部会创建一个ExitAction，调用此工具会退出LoopAgent }, }, }) if err != nil { log.Fatal(err) } return a } // 代码优化 Agent func NewCodeOptimizerAgent() adk.Agent { a, err := adk.NewChatModelAgent(context.Background(), \u0026adk.ChatModelAgentConfig{ Name: \"CodeOptimizer\", Description: \"根据分析结果优化代码\", Instruction: `基于前面的代码分析结果，对代码进行优化改进： 1. 修复识别出的性能问题 2. 消除代码重复 3. 提高代码可读性 4. 修复潜在 bug 5. 应用最佳实践 请提供优化后的完整代码。`, Model: llm.CreateDeepseekModel(), }) if err != nil { log.Fatal(err) } return a } 代码优化agent // 代码优化 Agent func NewCodeOptimizerAgent() adk.Agent { a, err := adk.NewChatModelAgent(context.Background(), \u0026adk.ChatModelAgentConfig{ Name: \"CodeOptimizer\", Description: \"根据分析结果优化代码\", Instruction: `基于前面的代码分析结果，对代码进行优化改进： 1. 修复识别出的性能问题 2. 消除代码重复 3. 提高代码可读性 4. 修复潜在 bug 5. 应用最佳实践 请提供优化后的完整代码。`, Model: llm.CreateDeepseekModel(), }) if err != nil { log.Fatal(err) } return a } LoopAgent func LoopAgent(code string) { ctx := context.Background() //创建LoopAgent loopAgent, err := adk.NewLoopAgent(ctx, \u0026adk.LoopAgentConfig{ Name: \"code_optimization_loop\", Description: \"代码优化循环，循环执行代码分析和优化\", SubAgents: []adk.Agent{ NewCodeAnalyzerAgent(), NewCodeOptimizerAgent(), }, MaxIterations: 3, }) if err != nil { log.Fatal(err) } //运行agent runner := adk.NewRunner(ctx, adk.RunnerConfig{ Agent: loopAgent, }) fmt.Println(\"开始代码优化循环\") //开启迭代器 iter := runner.Query(ctx, \"请你优化以下go代码: \\n\"+code) count := 0 //记录第几轮 for { event, ok := iter.Next() if !ok { break } if event.Err != nil { log.Fatal(event.Err) } if event.Output != nil \u0026\u0026 event.Output.MessageOutput != nil { msg, err := event.Output.MessageOutput.GetMessage() if err != nil { log.Fatal(err) } if msg.Role == schema.Assistant { fmt.Printf(\"============第%d轮===================\\n\", count) fmt.Println(event.AgentName) fmt.Println(msg.Content) } if event.AgentName == \"CodeAnalyzer\" { if event.Action != nil \u0026\u0026 event.Action.Exit { fmt.Println(\"代码循环提前结束\") break } } if event.AgentName == \"CodeOptimizer\" { count++ } } } fmt.Println(\"代码优化循环结束\") } 最后调用 func main() { LoopAgent(`func processData(data []int) []int { result := []int{} for i := 0; i \u003c len(data); i++ { for j := 0; j \u003c len(data); j++ { if data[i] \u003e data[j] { result = append(result, data[i]) break } } } return result }`) } ",
  "wordCount" : "349",
  "inLanguage": "zh",
  "datePublished": "2026-01-13T21:14:37+08:00",
  "dateModified": "2026-01-13T21:14:37+08:00",
  "author":{
    "@type": "Person",
    "name": "印象简单/EasyImpr"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://yinxiangpingfan.github.io/agent/loopagent%E5%BE%AA%E7%8E%AF%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "印象简单的博客",
    "logo": {
      "@type": "ImageObject",
      "url": "https://yinxiangpingfan.github.io/favicon.ico"
    }
  }
}
</script>
    <link rel="icon" href="/images/%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_2025-11-23_104342_537.jpg" sizes="16x16">

<link rel="apple-touch-icon" href="/images/%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_2025-11-23_104342_537.jpg">

<link rel="manifest" href="/images/%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_2025-11-23_104342_537.jpg">
    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css" />

    
    
    <link rel="stylesheet" href="/css/main.min.ec28f09e946fc0df77c187fcd0d0ebde58fca6de8efb8e1620f3d45c32d4da88.css" integrity="sha256-7CjwnpRvwN93wYf80NDr3lj8pt6O&#43;44WIPPUXDLU2og=" crossorigin="anonymous" media="screen" />

    
    <link rel="stylesheet" href="/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css" />

    
    <script src="/js/highlight.min.min.65a3017a8aabe1f9330e70527075c8d51bc9634d5cac35077af03588c1df8078.js"></script>
    <script>hljs.highlightAll();</script>

    <script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script>
    </head>
<body>
      <main class="wrapper"><nav class="navigation">
    <section class="container">
        <a class="navigation-brand" href="/">
            主页
        </a>
        <input type="checkbox" id="menu-toggle" />
        <label class="menu-button float-right" for="menu-toggle">
            <span></span><span></span><span></span>
        </label>
        
        <ul class="navigation-list" id="navigation-list">
            
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/code/">开发</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/agent/">Agent</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/life/">生活</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/friend/">友情链接</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/guestbook/">留言板</a>
            </li>
            
            

            <li class="navigation-item menu-separator">
                <span>|</span>
            </li>

            
            
            <li class="navigation-item navigation-social">
                <a class="navigation-link" href="https://github.com/yinxiangpingfan"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
            </li>
            
            <li class="navigation-item navigation-social">
                <a class="navigation-link" href="mailto:ecygbsj@163.com"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a>
            </li>
            
            

            <li class="navigation-item navigation-dark">
                <button id="mode" type="button" aria-label="toggle user light or dark theme">
                    <span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
                    <span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
                </button>
            </li>

            
            
        </ul>
        
    </section>
</nav>
<div id="content">
<article class="blog-single">
  <header class="blog-title">
    <h1>LoopAgent循环优化代码</h1>
  </header>

  <p>
  <small>
    2026年1月13日&nbsp;· 349 字&nbsp;· 2 分钟</small>

  
<p>

  <div class="blog-toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#代码分析agent">代码分析agent</a></li>
    <li><a href="#代码优化agent">代码优化agent</a></li>
    <li><a href="#loopagent">LoopAgent</a></li>
    <li><a href="#最后调用">最后调用</a></li>
  </ul>
</nav>
  </div>

  <section class="blog-content"><p>这里演示LoopAgent的使用方法，使用一个代码优化作为例子</p>
<h1 id="loopagent循环优化代码">LoopAgent循环优化代码</h1>
<p>LoopAgent 的执行遵循以下设定：</p>
<p>循环执行：重复执行 SubAgents 序列（序列是“有序的”）</p>
<p>History 累积：每次迭代的结果都会累积到 History 中，后续迭代可以访问所有历史信息</p>
<p>条件退出：达到最大迭代次数来终止循环，配置 MaxIterations=0 时表示无限循环</p>
<p>这里演示代码优化的LoopAgent，分为两个Agent，最大进行3轮循环</p>
<h2 id="代码分析agent">代码分析agent</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 代码分析 Agent</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCodeAnalyzerAgent</span>() <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">Agent</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">NewChatModelAgent</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">ChatModelAgentConfig</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>:        <span style="color:#e6db74">&#34;CodeAnalyzer&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;分析代码质量和性能问题&#34;</span>, <span style="color:#75715e">// 描述Agent功能</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Instruction</span>: <span style="color:#e6db74">`你是一个代码分析专家。你的职责是分析代码问题，不是优化代码。
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">请分析当前代码是否存在以下5种问题：
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1. 性能瓶颈
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2. 代码重复
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">3. 可读性问题
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">4. 潜在的 bug
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">5. 不符合最佳实践的地方
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">重要规则：
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- 如果发现任何问题，只需列出问题，然后结束回答，不要调用 exit tool
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- 只分析和指出问题，绝对不要给出优化建议或给出优化后的代码
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- 不要自己尝试优化代码，优化工作由 CodeOptimizer 负责
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- 只有在代码完全没有任何问题时，才调用 exit tool`</span>, <span style="color:#75715e">// Instruction是SystemMessage</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Model</span>: <span style="color:#a6e22e">llm</span>.<span style="color:#a6e22e">CreateDeepseekModel</span>(),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ToolsConfig</span>: <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">ToolsConfig</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ToolsNodeConfig</span>: <span style="color:#a6e22e">compose</span>.<span style="color:#a6e22e">ToolsNodeConfig</span>{
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">Tools</span>: []<span style="color:#a6e22e">tool</span>.<span style="color:#a6e22e">BaseTool</span>{<span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">ExitTool</span>{}}, <span style="color:#75715e">// ExitTool内部会创建一个ExitAction，调用此工具会退出LoopAgent</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 代码优化 Agent</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCodeOptimizerAgent</span>() <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">Agent</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">NewChatModelAgent</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">ChatModelAgentConfig</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>:        <span style="color:#e6db74">&#34;CodeOptimizer&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;根据分析结果优化代码&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Instruction</span>: <span style="color:#e6db74">`基于前面的代码分析结果，对代码进行优化改进：
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1. 修复识别出的性能问题
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2. 消除代码重复
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">3. 提高代码可读性
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">4. 修复潜在 bug
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">5. 应用最佳实践
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">请提供优化后的完整代码。`</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Model</span>: <span style="color:#a6e22e">llm</span>.<span style="color:#a6e22e">CreateDeepseekModel</span>(),
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="代码优化agent">代码优化agent</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 代码优化 Agent</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCodeOptimizerAgent</span>() <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">Agent</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">NewChatModelAgent</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">ChatModelAgentConfig</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>:        <span style="color:#e6db74">&#34;CodeOptimizer&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;根据分析结果优化代码&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Instruction</span>: <span style="color:#e6db74">`基于前面的代码分析结果，对代码进行优化改进：
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1. 修复识别出的性能问题
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2. 消除代码重复
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">3. 提高代码可读性
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">4. 修复潜在 bug
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">5. 应用最佳实践
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">请提供优化后的完整代码。`</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Model</span>: <span style="color:#a6e22e">llm</span>.<span style="color:#a6e22e">CreateDeepseekModel</span>(),
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="loopagent">LoopAgent</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">LoopAgent</span>(<span style="color:#a6e22e">code</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//创建LoopAgent</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">loopAgent</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">NewLoopAgent</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">LoopAgentConfig</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>:        <span style="color:#e6db74">&#34;code_optimization_loop&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Description</span>: <span style="color:#e6db74">&#34;代码优化循环，循环执行代码分析和优化&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">SubAgents</span>: []<span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">Agent</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">NewCodeAnalyzerAgent</span>(),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">NewCodeOptimizerAgent</span>(),
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">MaxIterations</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//运行agent</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">runner</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">NewRunner</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">adk</span>.<span style="color:#a6e22e">RunnerConfig</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Agent</span>: <span style="color:#a6e22e">loopAgent</span>,
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;开始代码优化循环&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//开启迭代器</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">iter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">runner</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;请你优化以下go代码: \n&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">code</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">count</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">//记录第几轮</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">iter</span>.<span style="color:#a6e22e">Next</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Err</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Output</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Output</span>.<span style="color:#a6e22e">MessageOutput</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">msg</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Output</span>.<span style="color:#a6e22e">MessageOutput</span>.<span style="color:#a6e22e">GetMessage</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Role</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">schema</span>.<span style="color:#a6e22e">Assistant</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;============第%d轮===================\n&#34;</span>, <span style="color:#a6e22e">count</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">AgentName</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Content</span>)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">AgentName</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;CodeAnalyzer&#34;</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Action</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">Action</span>.<span style="color:#a6e22e">Exit</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;代码循环提前结束&#34;</span>)
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">AgentName</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;CodeOptimizer&#34;</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;代码优化循环结束&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="最后调用">最后调用</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LoopAgent</span>(<span style="color:#e6db74">`func processData(data []int) []int {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    result := []int{}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for i := 0; i &lt; len(data); i++ {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        for j := 0; j &lt; len(data); j++ {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            if data[i] &gt; data[j] {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                result = append(result, data[i])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                break
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    return result
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}`</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section>

  
  
  <div class="paginator">
    
    
    <a class="next" href="https://yinxiangpingfan.github.io/agent/%E6%B5%81%E7%A8%8B%E7%9A%84%E4%B8%AD%E6%96%AD%E4%B8%8E%E5%9B%9E%E5%A4%8D/"><span>流程的中断与回复</span>
      <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375C21.4339 3.93962 21.3581 3.30535 21.1917 2.76787M3.77086 21.1546C1.9934 20.7777 0.973585 18.7264 1.08749 16.688C1.2668 13.479 1.15721 9.43135 1.00513 6.21507C0.87809 3.52811 3.12891 1.16316 5.51029 1.25008C9.76594 1.40542 15.377 1.20229 18.7912 1.00542C20.0864 0.930734 20.8406 1.63385 21.1917 2.76787M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787C23.1097 4.18217 23.13 12.4191 22.9004 16.3608C20.8478 24.0194 12.3061 23.6662 6.5 22.0658M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608C21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966C16.0174 11.8297 16.0154 11.9753 15.9494 12.0063C14.945 12.4779 13.0706 13.9264 12.055 15M15.5556 11.9667C13.1345 12.0608 8 12 6 11" stroke="currentColor" stroke-linecap="round"/>
      </svg>
    </a>
    
  </div>
  

  

<div class="related-resources">
  
    
    
    
  
</div>


  
  
<div class="comments">
  <script>
      const getTheme = window.localStorage && window.localStorage.getItem("theme");
      let theme = getTheme === 'dark' ? 'dark' : 'light';
      let s = document.createElement('script');
      s.src = 'https://giscus.app/client.js';
      s.setAttribute('data-repo', 'yinxiangpingfan\/yinxiangpingfan.github.io');
      s.setAttribute('data-repo-id', 'R_kgDOQ3n2PQ');
      s.setAttribute('data-category', 'Announcements');
      s.setAttribute('data-category-id', 'DIC_kwDOQ3n2Pc4C0-Rs');
      s.setAttribute('data-mapping', 'pathname');
      s.setAttribute('data-strict', '0');
      s.setAttribute('data-reactions-enabled', '1');
      s.setAttribute('data-emit-metadata', '0');
      s.setAttribute('data-input-position', 'top');
      s.setAttribute('data-theme', theme);
      s.setAttribute('data-lang', 'zh-CN');
      s.setAttribute('data-loading', 'lazy');
      s.setAttribute('crossorigin', 'anonymous');
      s.setAttribute('async', '');
      document.querySelector('div.comments').innerHTML = '';
      document.querySelector('div.comments').appendChild(s);
  </script>
</div>

</article>

        </div><footer class="footer">
  <p>&copy; 2026 <a href="https://yinxiangpingfan.github.io/">印象简单的博客</a>
    Powered by
    <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>
    <a href="https://github.com/guangzhengli/hugo-theme-ladder" rel="noopener" target="_blank">Ladder</a>
️  </p>
</footer>

<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211C22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257M21.7387 7.71865C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257C17.1684 -1.24629 7.83127 0.632493 4.27577 5.04257C2.88063 6.77451 -0.0433281 11.1668 1.38159 16.6571C2.27481 20.0988 5.17269 22.2936 8.19743 22.7725M20.7188 5.04257C22.0697 6.9404 24.0299 11.3848 22.3541 15.4153M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814C11.1703 6.98257 11.0247 6.98456 10.9937 7.05061C10.5221 8.05496 9.07362 9.92941 8 10.945M11.0333 7.44444C10.9392 9.86549 11 15 12 17" stroke="currentColor" stroke-linecap="round"/>
    </svg>
</a>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>

<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copy';

        function copyingDone() {
            copybutton.innerHTML = 'Copied';
            setTimeout(() => {
                copybutton.innerHTML = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });
        codeblock.parentNode.appendChild(copybutton);
    });
</script></main>
    </body><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
      const images = Array.from(document.querySelectorAll(".blog-content img"));
      images.forEach(img => {
          mediumZoom(img, {
              margin: 10,  
              scrollOffset: 40,  
              container: null,  
              template: null,  
              background: 'rgba(0, 0, 0, 0.5)'
          });
      });
  </script>

  
  <script src="/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js" integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin="anonymous" defer></script></html>
